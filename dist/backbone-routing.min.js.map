{"version":3,"file":"backbone-routing.js","sources":["backbone-routing.js","/source/backbone-routing.js"],"names":["global","factory","exports","module","require","define","amd","Backbone","Routing","Metal","this","Route","Class","extend","constructor","listenTo","history","_onHistoryRoute","_super","apply","arguments","fetch","render","destroy","router","_isActive","enter","args","_triggerMethod","Promise","resolve","then","_this","err","exit","_this2","stopListening","name","callbackName","trigger","concat","backbone_routing___prevRoute","undefined","Router","isActive","execute","callback","wasInactive","onBeforeEnter","onBeforeRoute","_execute","_this3","onEnter","onRoute","onError","route","_this4","backbone_routing"],"mappings":"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","sourceRoot":"/source/","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('backbone'), require('backbone-metal')) :\n  typeof define === 'function' && define.amd ? define(['backbone', 'backbone-metal'], factory) :\n  global.Backbone.Routing = factory(global.Backbone, global.Metal)\n}(this, function (Backbone, Metal) { 'use strict';\n\n  /*jshint -W120 */\n  const Route = Metal.Class.extend({\n    constructor() {\n      this.listenTo(Backbone.history, 'route', this._onHistoryRoute);\n      this._super(...arguments);\n    },\n\n    fetch() {},\n\n    render() {},\n\n    destroy() {},\n\n    _onHistoryRoute(router) {\n      this._isActive = (router === this);\n    },\n\n    enter(args) {\n      this._triggerMethod('before:enter', 'onBeforeEnter', args);\n      this._triggerMethod('before:fetch', 'onBeforeFetch', args);\n      return Promise.resolve()\n        .then(() => this.fetch(...args))\n        .then(() => {\n          this._triggerMethod('fetch', 'onFetch', args);\n          this._triggerMethod('before:render', 'onBeforeRender', args);\n        })\n        .then(() => this.render(...args))\n        .then(() => {\n          this._triggerMethod('render', 'onRender', args);\n          this._triggerMethod('enter', 'onEnter', args);\n        })\n        .catch(err => {\n          this._triggerMethod('error', 'onError', [err]);\n          this._triggerMethod('error:enter', 'onErrorEnter', [err]);\n          throw err;\n        });\n    },\n\n    exit() {\n      this._triggerMethod('before:exit', 'onBeforeExit');\n      this._triggerMethod('before:destroy', 'onBeforeDestroy');\n      return Promise.resolve()\n        .then(() => this.destroy())\n        .then(() => {\n          this._triggerMethod('destroy', 'onDestroy');\n          this._triggerMethod('exit', 'onExit');\n          this.stopListening();\n        })\n        .catch(err => {\n          this._triggerMethod('error', 'onError', [err]);\n          this._triggerMethod('error:exit', 'onErrorExit', [err]);\n          this.stopListening();\n          throw err;\n        });\n    },\n\n    _triggerMethod(name, callbackName, args) {\n      if (this[callbackName]) {\n        this[callbackName](...args);\n      }\n      this.trigger(name, this, ...args);\n\n      if (!this.router) {\n        return;\n      }\n\n      if (this.router[callbackName + 'Route']) {\n        this.router[callbackName + 'Route'](this);\n      }\n      this.trigger(name + ':route', this);\n    }\n  });\n\n  let backbone_routing___prevRoute;\n\n  const Router = Metal.Class.extend({\n    constructor() {\n      this.listenTo(Backbone.history, 'route', this._onHistoryRoute);\n      this._super(...arguments);\n    },\n\n    isActive() {\n      return !!this._isActive;\n    },\n\n    execute(callback, args) {\n      var wasInactive = !this._isActive;\n      if (wasInactive) {\n        this.onBeforeEnter();\n        this.trigger('before:enter', this);\n      }\n\n      this.onBeforeRoute();\n      this.trigger('before:route', this);\n\n      Promise.resolve(this._execute(callback, args))\n        .then(() => {\n          if (wasInactive) {\n            this.onEnter();\n            this.trigger('enter');\n          }\n\n          this.onRoute();\n          this.trigger('route');\n        })\n        .catch(err => {\n          this.onError(err);\n          this.trigger('error', this, err);\n          Backbone.history.trigger('error', this, err);\n        });\n    },\n\n    _execute(callback, args) {\n      return Promise.resolve()\n        .then(() => {\n          if (backbone_routing___prevRoute instanceof Route) {\n            return backbone_routing___prevRoute.exit();\n          }\n        })\n        .then(() => {\n          let route = backbone_routing___prevRoute = callback.apply(this, args);\n          if (route instanceof Route) {\n            route.router = this;\n            return route.enter(args);\n          }\n        });\n    },\n\n    _onHistoryRoute(router) {\n      this._isActive = (router === this);\n    }\n  });\n\n  var backbone_routing = {Route, Router};\n\n  return backbone_routing;\n\n}));\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('backbone'), require('backbone-metal')) :\n  typeof define === 'function' && define.amd ? define(['backbone', 'backbone-metal'], factory) :\n  global.Backbone.Routing = factory(global.Backbone, global.Metal)\n}(this, function (Backbone, Metal) { 'use strict';\n\n  /*jshint -W120 */\n  const Route = Metal.Class.extend({\n    constructor() {\n      this.listenTo(Backbone.history, 'route', this._onHistoryRoute);\n      this._super(...arguments);\n    },\n\n    fetch() {},\n\n    render() {},\n\n    destroy() {},\n\n    _onHistoryRoute(router) {\n      this._isActive = (router === this);\n    },\n\n    enter(args) {\n      this._triggerMethod('before:enter', 'onBeforeEnter', args);\n      this._triggerMethod('before:fetch', 'onBeforeFetch', args);\n      return Promise.resolve()\n        .then(() => this.fetch(...args))\n        .then(() => {\n          this._triggerMethod('fetch', 'onFetch', args);\n          this._triggerMethod('before:render', 'onBeforeRender', args);\n        })\n        .then(() => this.render(...args))\n        .then(() => {\n          this._triggerMethod('render', 'onRender', args);\n          this._triggerMethod('enter', 'onEnter', args);\n        })\n        .catch(err => {\n          this._triggerMethod('error', 'onError', [err]);\n          this._triggerMethod('error:enter', 'onErrorEnter', [err]);\n          throw err;\n        });\n    },\n\n    exit() {\n      this._triggerMethod('before:exit', 'onBeforeExit');\n      this._triggerMethod('before:destroy', 'onBeforeDestroy');\n      return Promise.resolve()\n        .then(() => this.destroy())\n        .then(() => {\n          this._triggerMethod('destroy', 'onDestroy');\n          this._triggerMethod('exit', 'onExit');\n          this.stopListening();\n        })\n        .catch(err => {\n          this._triggerMethod('error', 'onError', [err]);\n          this._triggerMethod('error:exit', 'onErrorExit', [err]);\n          this.stopListening();\n          throw err;\n        });\n    },\n\n    _triggerMethod(name, callbackName, args) {\n      if (this[callbackName]) {\n        this[callbackName](...args);\n      }\n      this.trigger(name, this, ...args);\n\n      if (!this.router) {\n        return;\n      }\n\n      if (this.router[callbackName + 'Route']) {\n        this.router[callbackName + 'Route'](this);\n      }\n      this.trigger(name + ':route', this);\n    }\n  });\n\n  let backbone_routing___prevRoute;\n\n  const Router = Metal.Class.extend({\n    constructor() {\n      this.listenTo(Backbone.history, 'route', this._onHistoryRoute);\n      this._super(...arguments);\n    },\n\n    isActive() {\n      return !!this._isActive;\n    },\n\n    execute(callback, args) {\n      var wasInactive = !this._isActive;\n      if (wasInactive) {\n        this.onBeforeEnter();\n        this.trigger('before:enter', this);\n      }\n\n      this.onBeforeRoute();\n      this.trigger('before:route', this);\n\n      Promise.resolve(this._execute(callback, args))\n        .then(() => {\n          if (wasInactive) {\n            this.onEnter();\n            this.trigger('enter');\n          }\n\n          this.onRoute();\n          this.trigger('route');\n        })\n        .catch(err => {\n          this.onError(err);\n          this.trigger('error', this, err);\n          Backbone.history.trigger('error', this, err);\n        });\n    },\n\n    _execute(callback, args) {\n      return Promise.resolve()\n        .then(() => {\n          if (backbone_routing___prevRoute instanceof Route) {\n            return backbone_routing___prevRoute.exit();\n          }\n        })\n        .then(() => {\n          let route = backbone_routing___prevRoute = callback.apply(this, args);\n          if (route instanceof Route) {\n            route.router = this;\n            return route.enter(args);\n          }\n        });\n    },\n\n    _onHistoryRoute(router) {\n      this._isActive = (router === this);\n    }\n  });\n\n  var backbone_routing = {Route, Router};\n\n  return backbone_routing;\n\n}));\n"]}