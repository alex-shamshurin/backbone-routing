{"version":3,"file":"backbone-routing.js","sources":["backbone-routing.js","/source/backbone-routing.js"],"names":["global","factory","exports","module","require","define","amd","Backbone","Routing","Metal","this","Route","Class","extend","constructor","listenTo","history","_onHistoryRoute","_super","apply","arguments","fetch","render","destroy","router","_isActive","enter","args","undefined","_triggerMethod","Promise","resolve","then","_this","err","exit","_this2","stopListening","name","callbackName","trigger","concat","Router","isActive","execute","callback","wasInactive","onBeforeEnter","onBeforeRoute","_execute","_this3","onEnter","onRoute","onError","_prevRoute","route","_this4","backbone_routing"],"mappings":"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","sourceRoot":"/source/","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('backbone'), require('backbone-metal')) :\n  typeof define === 'function' && define.amd ? define(['backbone', 'backbone-metal'], factory) :\n  global.Backbone.Routing = factory(global.Backbone, global.Metal)\n}(this, function (Backbone, Metal) { 'use strict';\n\n  const Route = Metal.Class.extend({\n    constructor() {\n      this.listenTo(Backbone.history, 'route', this._onHistoryRoute);\n      this._super(...arguments);\n    },\n\n    /**\n     * @public\n     * @abstract\n     * @method fetch\n     */\n    fetch() {},\n\n    /**\n     * @public\n     * @abstract\n     * @method render\n     */\n    render() {},\n\n    /**\n     * @public\n     * @abstract\n     * @method destroy\n     */\n    destroy() {},\n\n    /**\n     * @private\n     * @method _onHistoryRoute\n     */\n    _onHistoryRoute(router) {\n      this._isActive = (router === this);\n    },\n\n    /**\n     * @public\n     * @method enter\n     * @returns {Promise}\n     */\n    enter(args = []) {\n      this._triggerMethod('before:enter', 'onBeforeEnter', args);\n      this._triggerMethod('before:fetch', 'onBeforeFetch', args);\n      return Promise.resolve()\n        .then(() => this.fetch(...args))\n        .then(() => {\n          this._triggerMethod('fetch', 'onFetch', args);\n          this._triggerMethod('before:render', 'onBeforeRender', args);\n        })\n        .then(() => this.render(...args))\n        .then(() => {\n          this._triggerMethod('render', 'onRender', args);\n          this._triggerMethod('enter', 'onEnter', args);\n        })\n        .catch(err => {\n          this._triggerMethod('error', 'onError', [err]);\n          this._triggerMethod('error:enter', 'onErrorEnter', [err]);\n          throw err;\n        });\n    },\n\n    /**\n     * @public\n     * @method exit\n     * @returns {Promise}\n     */\n    exit() {\n      this._triggerMethod('before:exit', 'onBeforeExit');\n      this._triggerMethod('before:destroy', 'onBeforeDestroy');\n      return Promise.resolve()\n        .then(() => this.destroy())\n        .then(() => {\n          this._triggerMethod('destroy', 'onDestroy');\n          this._triggerMethod('exit', 'onExit');\n          this.stopListening();\n        })\n        .catch(err => {\n          this._triggerMethod('error', 'onError', [err]);\n          this._triggerMethod('error:exit', 'onErrorExit', [err]);\n          this.stopListening();\n          throw err;\n        });\n    },\n\n    /**\n     * @private\n     * @method _triggerMethod\n     * @param {String} name\n     * @param {String} callbackName\n     * @param {array} [args]\n     */\n    _triggerMethod(name, callbackName, args = []) {\n      if (this[callbackName]) {\n        this[callbackName](...args);\n      }\n      this.trigger(name, this, ...args);\n\n      if (!this.router) {\n        return;\n      }\n\n      if (this.router[callbackName + 'Route']) {\n        this.router[callbackName + 'Route'](this);\n      }\n      this.trigger(name + ':route', this);\n    }\n  });\n\n  /**\n   * @public\n   * @class Router\n   */\n  const Router = Metal.Class.extend({\n    constructor() {\n      this.listenTo(Backbone.history, 'route', this._onHistoryRoute);\n      this._super(...arguments);\n    },\n\n    /**\n     * @public\n     * @method isActive\n     * @returns {Boolean}\n     */\n    isActive() {\n      return !!this._isActive;\n    },\n\n    /**\n     * @public\n     * @method execute\n     * @param {Function} callback\n     * @param {Array} [args]\n     */\n    execute(callback, args) {\n      var wasInactive = !this._isActive;\n      if (wasInactive) {\n        this.onBeforeEnter();\n        this.trigger('before:enter', this);\n      }\n\n      this.onBeforeRoute();\n      this.trigger('before:route', this);\n\n      Promise.resolve(this._execute(callback, args)).then(() => {\n        if (wasInactive) {\n          this.onEnter();\n          this.trigger('enter');\n        }\n\n        this.onRoute();\n        this.trigger('route');\n      }).catch(err => {\n        this.onError(err);\n        this.trigger('error', this, err);\n        Backbone.history.trigger('error', this, err);\n      });\n    },\n\n    /**\n     * @public\n     * @method execute\n     * @param {Function} callback\n     * @param {Array} [args]\n     * @returns {Promise}\n     */\n    _execute(callback, args) {\n      return Promise.resolve().then(() => {\n        if (Router._prevRoute instanceof Route) {\n          return Router._prevRoute.exit();\n        }\n      }).then(() => {\n        let route = Router._prevRoute = callback.apply(this, args);\n        if (route instanceof Route) {\n          route.router = this;\n          return route.enter(args);\n        }\n      });\n    },\n\n    /**\n     * @private\n     * @method _onHistoryRoute\n     * @param {Router} router\n     */\n    _onHistoryRoute(router) {\n      this._isActive = (router === this);\n    }\n  }, {\n\n    /**\n     * @private\n     * @member _prevRoute\n     */\n    _prevRoute: null\n  });\n\n  var backbone_routing = {Route, Router};\n\n  return backbone_routing;\n\n}));\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('backbone'), require('backbone-metal')) :\n  typeof define === 'function' && define.amd ? define(['backbone', 'backbone-metal'], factory) :\n  global.Backbone.Routing = factory(global.Backbone, global.Metal)\n}(this, function (Backbone, Metal) { 'use strict';\n\n  const Route = Metal.Class.extend({\n    constructor() {\n      this.listenTo(Backbone.history, 'route', this._onHistoryRoute);\n      this._super(...arguments);\n    },\n\n    /**\n     * @public\n     * @abstract\n     * @method fetch\n     */\n    fetch() {},\n\n    /**\n     * @public\n     * @abstract\n     * @method render\n     */\n    render() {},\n\n    /**\n     * @public\n     * @abstract\n     * @method destroy\n     */\n    destroy() {},\n\n    /**\n     * @private\n     * @method _onHistoryRoute\n     */\n    _onHistoryRoute(router) {\n      this._isActive = (router === this);\n    },\n\n    /**\n     * @public\n     * @method enter\n     * @returns {Promise}\n     */\n    enter(args = []) {\n      this._triggerMethod('before:enter', 'onBeforeEnter', args);\n      this._triggerMethod('before:fetch', 'onBeforeFetch', args);\n      return Promise.resolve()\n        .then(() => this.fetch(...args))\n        .then(() => {\n          this._triggerMethod('fetch', 'onFetch', args);\n          this._triggerMethod('before:render', 'onBeforeRender', args);\n        })\n        .then(() => this.render(...args))\n        .then(() => {\n          this._triggerMethod('render', 'onRender', args);\n          this._triggerMethod('enter', 'onEnter', args);\n        })\n        .catch(err => {\n          this._triggerMethod('error', 'onError', [err]);\n          this._triggerMethod('error:enter', 'onErrorEnter', [err]);\n          throw err;\n        });\n    },\n\n    /**\n     * @public\n     * @method exit\n     * @returns {Promise}\n     */\n    exit() {\n      this._triggerMethod('before:exit', 'onBeforeExit');\n      this._triggerMethod('before:destroy', 'onBeforeDestroy');\n      return Promise.resolve()\n        .then(() => this.destroy())\n        .then(() => {\n          this._triggerMethod('destroy', 'onDestroy');\n          this._triggerMethod('exit', 'onExit');\n          this.stopListening();\n        })\n        .catch(err => {\n          this._triggerMethod('error', 'onError', [err]);\n          this._triggerMethod('error:exit', 'onErrorExit', [err]);\n          this.stopListening();\n          throw err;\n        });\n    },\n\n    /**\n     * @private\n     * @method _triggerMethod\n     * @param {String} name\n     * @param {String} callbackName\n     * @param {array} [args]\n     */\n    _triggerMethod(name, callbackName, args = []) {\n      if (this[callbackName]) {\n        this[callbackName](...args);\n      }\n      this.trigger(name, this, ...args);\n\n      if (!this.router) {\n        return;\n      }\n\n      if (this.router[callbackName + 'Route']) {\n        this.router[callbackName + 'Route'](this);\n      }\n      this.trigger(name + ':route', this);\n    }\n  });\n\n  /**\n   * @public\n   * @class Router\n   */\n  const Router = Metal.Class.extend({\n    constructor() {\n      this.listenTo(Backbone.history, 'route', this._onHistoryRoute);\n      this._super(...arguments);\n    },\n\n    /**\n     * @public\n     * @method isActive\n     * @returns {Boolean}\n     */\n    isActive() {\n      return !!this._isActive;\n    },\n\n    /**\n     * @public\n     * @method execute\n     * @param {Function} callback\n     * @param {Array} [args]\n     */\n    execute(callback, args) {\n      var wasInactive = !this._isActive;\n      if (wasInactive) {\n        this.onBeforeEnter();\n        this.trigger('before:enter', this);\n      }\n\n      this.onBeforeRoute();\n      this.trigger('before:route', this);\n\n      Promise.resolve(this._execute(callback, args)).then(() => {\n        if (wasInactive) {\n          this.onEnter();\n          this.trigger('enter');\n        }\n\n        this.onRoute();\n        this.trigger('route');\n      }).catch(err => {\n        this.onError(err);\n        this.trigger('error', this, err);\n        Backbone.history.trigger('error', this, err);\n      });\n    },\n\n    /**\n     * @public\n     * @method execute\n     * @param {Function} callback\n     * @param {Array} [args]\n     * @returns {Promise}\n     */\n    _execute(callback, args) {\n      return Promise.resolve().then(() => {\n        if (Router._prevRoute instanceof Route) {\n          return Router._prevRoute.exit();\n        }\n      }).then(() => {\n        let route = Router._prevRoute = callback.apply(this, args);\n        if (route instanceof Route) {\n          route.router = this;\n          return route.enter(args);\n        }\n      });\n    },\n\n    /**\n     * @private\n     * @method _onHistoryRoute\n     * @param {Router} router\n     */\n    _onHistoryRoute(router) {\n      this._isActive = (router === this);\n    }\n  }, {\n\n    /**\n     * @private\n     * @member _prevRoute\n     */\n    _prevRoute: null\n  });\n\n  var backbone_routing = {Route, Router};\n\n  return backbone_routing;\n\n}));\n"]}