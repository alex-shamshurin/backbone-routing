!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("backbone"),require("backbone-metal")):"function"==typeof define&&define.amd?define(["backbone","backbone-metal"],t):e.Backbone.Routing=t(e.Backbone,e.Metal)}(this,function(e,t){"use strict";var r=t.Class.extend({constructor:function(){this.listenTo(e.history,"route",this._onHistoryRoute),this._super.apply(this,arguments)},fetch:function(){},render:function(){},destroy:function(){},_onHistoryRoute:function(e){this._isActive=e===this},enter:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0];return this._triggerMethod("before:enter","onBeforeEnter",t),this._triggerMethod("before:fetch","onBeforeFetch",t),Promise.resolve().then(function(){return e.fetch.apply(e,t)}).then(function(){e._triggerMethod("fetch","onFetch",t),e._triggerMethod("before:render","onBeforeRender",t)}).then(function(){return e.render.apply(e,t)}).then(function(){e._triggerMethod("render","onRender",t),e._triggerMethod("enter","onEnter",t)})["catch"](function(t){throw e._triggerMethod("error","onError",[t]),e._triggerMethod("error:enter","onErrorEnter",[t]),t})},exit:function(){var e=this;return this._triggerMethod("before:exit","onBeforeExit"),this._triggerMethod("before:destroy","onBeforeDestroy"),Promise.resolve().then(function(){return e.destroy()}).then(function(){e._triggerMethod("destroy","onDestroy"),e._triggerMethod("exit","onExit"),e.stopListening()})["catch"](function(t){throw e._triggerMethod("error","onError",[t]),e._triggerMethod("error:exit","onErrorExit",[t]),e.stopListening(),t})},_triggerMethod:function(e,t){var r=void 0===arguments[2]?[]:arguments[2];this[t]&&this[t].apply(this,r),this.trigger.apply(this,[e,this].concat(r)),this.router&&(this.router[t+"Route"]&&this.router[t+"Route"](this),this.trigger(e+":route",this))}}),o=t.Class.extend({constructor:function(){this.listenTo(e.history,"route",this._onHistoryRoute),this._super.apply(this,arguments)},isActive:function(){return!!this._isActive},execute:function(t,r){var o=this,n=!this._isActive;n&&(this.onBeforeEnter(),this.trigger("before:enter",this)),this.onBeforeRoute(),this.trigger("before:route",this),Promise.resolve(this._execute(t,r)).then(function(){n&&(o.onEnter(),o.trigger("enter")),o.onRoute(),o.trigger("route")})["catch"](function(t){o.onError(t),o.trigger("error",o,t),e.history.trigger("error",o,t)})},_execute:function(e,t){var n=this;return Promise.resolve().then(function(){return o._prevRoute instanceof r?o._prevRoute.exit():void 0}).then(function(){var i=o._prevRoute=e.apply(n,t);return i instanceof r?(i.router=n,i.enter(t)):void 0})},_onHistoryRoute:function(e){this._isActive=e===this}},{_prevRoute:null}),n={Route:r,Router:o};return n});
//# sourceMappingURL=backbone-routing.min.js.map