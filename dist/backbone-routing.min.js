!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("backbone"),require("backbone-metal")):"function"==typeof define&&define.amd?define(["backbone","backbone-metal"],e):t.Backbone.Routing=e(t.Backbone,t.Metal)}(this,function(t,e){"use strict";var r=e.Class.extend({constructor:function(){this.listenTo(t.history,"route",this._onHistoryRoute),this._super.apply(this,arguments)},enter:function(){var t=this,e=void 0===arguments[0]?[]:arguments[0];return this.onBeforeEnter.apply(this,e),this.trigger.apply(this,["before:enter",this].concat(e)),this.onBeforeFetch.apply(this,e),this.trigger.apply(this,["before:fetch",this].concat(e)),Promise.resolve().then(function(){return t.fetch.apply(t,e)}).then(function(){t.onFetch.apply(t,e),t.trigger.apply(t,["fetch",t].concat(e)),t.onBeforeRender.apply(t,e),t.trigger.apply(t,["before:render",t].concat(e))}).then(function(){return t.render.apply(t,e)}).then(function(){t.onRender.apply(t,e),t.trigger.apply(t,["render",t].concat(e)),t.onEnter.apply(t,e),t.trigger.apply(t,["enter",t].concat(e))})["catch"](function(e){throw t.onError(e),t.trigger("error",t,e),t.onErrorEnter(e),t.trigger("error:enter",t,e),e})},exit:function(){var t=this;return this.onBeforeExit(),this.trigger("before:exit",this),this.onBeforeDestroy(),this.trigger("before:destroy",this),Promise.resolve().then(function(){return t.destroy()}).then(function(){t.onDestroy(),t.trigger("destroy",t),t.onExit(),t.trigger("exit",t),t.stopListening()})["catch"](function(e){throw t.onError(e),t.trigger("error",t,e),t.onErrorExit(e),t.trigger("error:exit",t,e),t.stopListening(),e})},onBeforeEnter:function(){},onBeforeFetch:function(){},fetch:function(){},onFetch:function(){},onBeforeRender:function(){},render:function(){},onRender:function(){},onEnter:function(){},onBeforeExit:function(){},onBeforeDestroy:function(){},destroy:function(){},onDestroy:function(){},onExit:function(){},onError:function(){},onErrorEnter:function(){},onErrorExit:function(){},_onHistoryRoute:function(t){this._isActive=t===this}}),n=e.Class.extend({constructor:function(){this.listenTo(t.history,"route",this._onHistoryRoute),this._super.apply(this,arguments)},isActive:function(){return!!this._isActive},execute:function(e,r){var n=this,o=!this._isActive;return o&&(this.onBeforeEnter(),this.trigger("before:enter",this)),this.onBeforeRoute(),this.trigger("before:route",this),Promise.resolve().then(function(){return n._execute(e,r)}).then(function(){n.onRoute(),n.trigger("route",n),o&&(n.onEnter(),n.trigger("enter",n))})["catch"](function(e){n.onError(e),n.trigger("error",n,e),t.history.trigger("error",n,e)})},onBeforeEnter:function(){},onBeforeRoute:function(){},onRoute:function(){},onEnter:function(){},onError:function(){},_execute:function(t,e){var o=this;return Promise.resolve().then(function(){return n._prevRoute instanceof r?n._prevRoute.exit():void 0}).then(function(){var i=n._prevRoute=t.apply(o,e);return i instanceof r?(i.router=o,i.enter(e)):void 0})},_onHistoryRoute:function(t){this._isActive=t===this}},{_prevRoute:null}),o={Route:r,Router:n};return o});
//# sourceMappingURL=backbone-routing.min.js.map