!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("backbone"),require("backbone-metal")):"function"==typeof define&&define.amd?define(["backbone","backbone-metal"],t):e.Backbone.Routing=t(e.Backbone,e.Metal)}(this,function(e,t){"use strict";var r=t.Class.extend({constructor:function(){this.listenTo(e.history,"route",this._onHistoryRoute),this._super.apply(this,arguments)},fetch:function(){},render:function(){},destroy:function(){},_onHistoryRoute:function(e){this._isActive=e===this},enter:function(e){var t=this;return this._triggerMethod("before:enter","onBeforeEnter",e),this._triggerMethod("before:fetch","onBeforeFetch",e),Promise.resolve().then(function(){return t.fetch.apply(t,e)}).then(function(){t._triggerMethod("fetch","onFetch",e),t._triggerMethod("before:render","onBeforeRender",e)}).then(function(){return t.render.apply(t,e)}).then(function(){t._triggerMethod("render","onRender",e),t._triggerMethod("enter","onEnter",e)})["catch"](function(e){throw t._triggerMethod("error","onError",[e]),t._triggerMethod("error:enter","onErrorEnter",[e]),e})},exit:function(){var e=this;return this._triggerMethod("before:exit","onBeforeExit"),this._triggerMethod("before:destroy","onBeforeDestroy"),Promise.resolve().then(function(){return e.destroy()}).then(function(){e._triggerMethod("destroy","onDestroy"),e._triggerMethod("exit","onExit"),e.stopListening()})["catch"](function(t){throw e._triggerMethod("error","onError",[t]),e._triggerMethod("error:exit","onErrorExit",[t]),e.stopListening(),t})},_triggerMethod:function(e,t,r){this[t]&&this[t].apply(this,r),this.trigger.apply(this,[e,this].concat(r)),this.router&&(this.router[t+"Route"]&&this.router[t+"Route"](this),this.trigger(e+":route",this))}}),o=void 0,n=t.Class.extend({constructor:function(){this.listenTo(e.history,"route",this._onHistoryRoute),this._super.apply(this,arguments)},isActive:function(){return!!this._isActive},execute:function(t,r){var o=this,n=!this._isActive;n&&(this.onBeforeEnter(),this.trigger("before:enter",this)),this.onBeforeRoute(),this.trigger("before:route",this),Promise.resolve(this._execute(t,r)).then(function(){n&&(o.onEnter(),o.trigger("enter")),o.onRoute(),o.trigger("route")})["catch"](function(t){o.onError(t),o.trigger("error",o,t),e.history.trigger("error",o,t)})},_execute:function(e,t){var n=this;return Promise.resolve().then(function(){return o instanceof r?o.exit():void 0}).then(function(){var i=o=e.apply(n,t);return i instanceof r?(i.router=n,i.enter(t)):void 0})},_onHistoryRoute:function(e){this._isActive=e===this}}),i={Route:r,Router:n};return i});
//# sourceMappingURL=backbone-routing.min.js.map