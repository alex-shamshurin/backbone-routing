!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("backbone"),require("backbone-metal")):"function"==typeof define&&define.amd?define(["backbone","backbone-metal"],t):e.Backbone.Routing=t(e.Backbone,e.Metal)}(this,function(e,t){"use strict";var n=t.Error.extend({name:"CancellationError"}),r=t.Class.extend({enter:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0];return this._isEntering=!0,this.onBeforeEnter.apply(this,t),this.trigger.apply(this,["before:enter",this].concat(t)),this.onBeforeFetch.apply(this,t),this.trigger.apply(this,["before:fetch",this].concat(t)),Promise.resolve().then(function(){return e._isCancelled?Promise.reject(new n):e.fetch.apply(e,t)}).then(function(){e.onFetch.apply(e,t),e.trigger.apply(e,["fetch",e].concat(t)),e.onBeforeRender.apply(e,t),e.trigger.apply(e,["before:render",e].concat(t))}).then(function(){return e._isCancelled?Promise.reject(new n):e.render.apply(e,t)}).then(function(){e._isEntering=!1,e.onRender.apply(e,t),e.trigger.apply(e,["render",e].concat(t)),e.onEnter.apply(e,t),e.trigger.apply(e,["enter",e].concat(t))})["catch"](function(t){if(e._isEntering=!1,!(t instanceof n))throw e.onError(t),e.trigger("error",e,t),e.onErrorEnter(t),e.trigger("error:enter",e,t),t;e.onCancel(),e.trigger("cancel",e)})},exit:function(){var e=this;return this._isEntering&&this.cancel(),this._isExiting=!0,this.onBeforeExit(),this.trigger("before:exit",this),this.onBeforeDestroy(),this.trigger("before:destroy",this),Promise.resolve().then(function(){return e.destroy()}).then(function(){e._isExiting=!1,e.onDestroy(),e.trigger("destroy",e),e.onExit(),e.trigger("exit",e),e.stopListening()})["catch"](function(t){throw e._isExiting=!1,e.onError(t),e.trigger("error",e,t),e.onErrorExit(t),e.trigger("error:exit",e,t),e.stopListening(),t})},cancel:function(){var e=this;if(this._isEntering)return this.onBeforeCancel(),this.trigger("before:cancel",this),this._isCancelled=!0,new Promise(function(t,n){e.once("cancel",t),e.once("enter error",n)})},isEntering:function(){return!!this._isEntering},isExiting:function(){return!!this._isExiting},isCancelled:function(){return!!this._isCancelled},onBeforeEnter:function(){},onBeforeFetch:function(){},fetch:function(){},onFetch:function(){},onBeforeRender:function(){},render:function(){},onRender:function(){},onEnter:function(){},onBeforeExit:function(){},onBeforeDestroy:function(){},destroy:function(){},onDestroy:function(){},onExit:function(){},onBeforeCancel:function(){},onCancel:function(){},onError:function(e){},onErrorEnter:function(e){},onErrorExit:function(e){}}),o=t.Class.extend(e.Router.prototype,e.Router).extend({constructor:function(){this.listenTo(e.history,"route",this._onHistoryRoute),this._super.apply(this,arguments)},isActive:function(){return!!this._isActive},execute:function(t,n){var r=this,o=!this._isActive;return o&&(this.onBeforeEnter(),this.trigger("before:enter",this)),this.onBeforeRoute(),this.trigger("before:route",this),Promise.resolve().then(function(){return r._execute(t,n)}).then(function(){r.onRoute(),r.trigger("route",r),o&&(r.onEnter(),r.trigger("enter",r))})["catch"](function(t){r.onError(t),r.trigger("error",r,t),e.history.trigger("error",r,t)})},onBeforeEnter:function(){},onBeforeRoute:function(){},onRoute:function(){},onEnter:function(){},onError:function(e){},_execute:function(e,t){var n=this;return Promise.resolve().then(function(){return o._prevRoute instanceof r?o._prevRoute.exit():void 0}).then(function(){var i=o._prevRoute=e.apply(n,t);return i instanceof r?(i.router=n,i.enter(t)):void 0})},_onHistoryRoute:function(e){this._isActive=e===this}},{_prevRoute:null}),i={Route:r,Router:o,CancellationError:n};return i});
//# sourceMappingURL=backbone-routing.min.js.map